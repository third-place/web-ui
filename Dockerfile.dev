FROM node:21.6.2-alpine3.18 AS build

ARG USER_SERVICE
ARG COMMUNITY_SERVICE
ARG NOTIFICATION_SERVICE
ARG IMAGE_SERVICE
ARG IMAGE_HOST

ENV USER_SERVICE=${USER_SERVICE}
ENV COMMUNITY_SERVICE=${COMMUNITY_SERVICE}
ENV NOTIFICATION_SERVICE=${NOTIFICATION_SERVICE}
ENV IMAGE_SERVICE=${IMAGE_SERVICE}
ENV IMAGE_HOST=${IMAGE_HOST}

WORKDIR /app
COPY . .
RUN npm install -g pnpm
RUN pnpm install --frozen-lockfile
RUN pnpm build

EXPOSE 4173

CMD ["pnpm", "preview"]
